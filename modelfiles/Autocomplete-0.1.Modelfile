# Ollama Modelfile for Fast Fill-in-the-Middle Autocomplete
# Model: Jadio/Qwen3_4b_instruct_q4km:latest (2.5GB)
# Purpose: Real-time code completion with <200ms latency

FROM Jadio/Qwen3_4b_instruct_q4km:latest

# Fill-in-the-Middle Template
# Qwen3 uses specific FIM tokens for code completion
# Format: <|fim_prefix|>code_before_cursor<|fim_suffix|>code_after_cursor<|fim_middle|>
TEMPLATE """<|fim_prefix|>{{ .Prompt }}<|fim_suffix|>{{ .Suffix }}<|fim_middle|>"""

# Minimal system message for maximum speed
SYSTEM """Complete the code."""

# === CRITICAL AUTOCOMPLETE PARAMETERS ===

# Sampling parameters - optimized for deterministic, fast completions
PARAMETER temperature 0.15
PARAMETER top_p 0.95
PARAMETER top_k 10
PARAMETER repeat_penalty 1.0
PARAMETER repeat_last_n 64

# Generation limits - tuned for IDE autocomplete
PARAMETER num_predict 128
PARAMETER num_ctx 2048

# Stop sequences for FIM
PARAMETER stop "<|fim_prefix|>"
PARAMETER stop "<|fim_suffix|>"
PARAMETER stop "<|fim_middle|>"
PARAMETER stop "<|endoftext|>"
PARAMETER stop "\n\n"
PARAMETER stop "```"

# Fixed seed for reproducibility
PARAMETER seed 42
