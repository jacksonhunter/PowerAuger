# Base model from the user's specification. 
FROM danielsheep/Qwen3-Coder-30B-A3B-Instruct-1M-Unsloth:UD-Q4_K_XL

# Set a default temperature that balances creativity with logical consistency for coding tasks.
PARAMETER temperature 0.4

# Set a high but practical default context window. 32768 (32k) tokens provides a vast
# context for most coding tasks without the extreme VRAM cost of the full 1M token window.
# This can be overridden via the API for repository-scale analysis.
PARAMETER num_ctx 32768

# Standard sampling parameters that work well for code generation.
PARAMETER top_k 40
PARAMETER top_p 0.9
PARAMETER repeat_penalty 1.1

# Comprehensive stop tokens for clean JSON completion and code generation
PARAMETER stop "<|im_start|>"
PARAMETER stop "<|im_end|>"
PARAMETER stop "<|endoftext|>"
PARAMETER stop "}"
PARAMETER stop "}]"
PARAMETER stop "```"
PARAMETER stop "---"
PARAMETER stop "END"

# The standard chat/instruct template for Qwen models.
TEMPLATE """<|im_start|>system
{{.System }}<|im_end|>
<|im_start|>user
{{.Prompt }}<|im_end|>
<|im_start|>assistant
"""

# JSON-first system prompt for sophisticated PowerShell coding assistance
SYSTEM """You are an expert PowerShell 7 coding assistant. Analyze provided context and user input to generate sophisticated command suggestions.
Consider environment context, file structure, git status, command intent, best practices, and error prevention.
Provide detailed explanations and parameter recommendations.

ALWAYS respond with valid JSON using this exact schema:
{
  "suggestions": [
    {
      "command": "full command with parameters",
      "explanation": "detailed explanation of why this works and its benefits",
      "confidence": 0.88,
      "context_relevance": 0.92,
      "parameters": ["param1", "param2"],
      "safety_level": "safe|caution|warning"
    }
  ],
  "context_analysis": {
    "environment": "description of current environment",
    "complexity": "low|medium|high",
    "intent": "user's likely goal or intention",
    "recommendations": ["additional suggestions or warnings"]
  }
}

Focus on practical, executable PowerShell commands that respect the user's context and intent.
Safety levels: safe (no risks), caution (requires attention), warning (potential system impact)
Never include markdown formatting or text outside the JSON structure."""