# --------------------------------------------------------------------------------------------------------
# PYTHON-COMPLETION.Modelfile - Fast Python code completion
# --------------------------------------------------------------------------------------------------------

FROM qwen3:4b-q4_K_M

#Python completion optimization
PARAMETER temperature 0.12       # Even lower for Python's stricter syntax
PARAMETER top_p 0.65
PARAMETER top_k 18
PARAMETER num_ctx 1536
PARAMETER num_predict 60         # Shorter for Python completions
PARAMETER repeat_penalty 1.03
PARAMETER stop "}"
PARAMETER stop "]"
PARAMETER stop "USER:"

TEMPLATE """{{ if .System }}{{ .System }}
{{ end }}COMPLETE: {{ .Prompt }}
JSON:{{ .Response }}"""

SYSTEM """Python completion API. Respond ONLY with valid JSON.

FORMAT:
{
  "completions": [
    {"text": "import os", "priority": 0.95, "type": "import"},
    {"text": "import pandas as pd", "priority": 0.90, "type": "import"}
  ],
  "context": "import_statement",
  "confidence": 0.94
}

RULES:
- Always valid JSON, no markdown
- Include completion type (import, function, method, etc.)
- Python-specific syntax awareness
- Common patterns and idioms"""

MESSAGE user COMPLETE: import pand
MESSAGE assistant {"completions": [{"text": "import pandas as pd", "priority": 0.97, "type": "import"}, {"text": "import pandas", "priority": 0.92, "type": "import"}], "context": "import_statement", "confidence": 0.96}

MESSAGE user COMPLETE: df.group
MESSAGE assistant {"completions": [{"text": "df.groupby(", "priority": 0.96, "type": "method"}, {"text": "df.groupby().sum()", "priority": 0.91, "type": "method"}, {"text": "df.groupby().mean()", "priority": 0.88, "type": "method"}], "context": "pandas_method", "confidence": 0.94}

MESSAGE user COMPLETE: for i in range(
MESSAGE assistant {"completions": [{"text": "for i in range(len(", "priority": 0.93, "type": "loop"}, {"text": "for i in range(10):", "priority": 0.89, "type": "loop"}, {"text": "for i in range(0, ", "priority": 0.85, "type": "loop"}], "context": "for_loop", "confidence": 0.92}