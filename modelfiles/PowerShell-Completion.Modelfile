# ========================================================================================================
# JSON-FIRST CONTINUE-COMPATIBLE MODELFILES
# Optimized for Continue VS Code extension and structured AI assistance
# ========================================================================================================

# --------------------------------------------------------------------------------------------------------
# POWERSHELL-COMPLETION.Modelfile - Ultra-fast PowerShell code completion
# --------------------------------------------------------------------------------------------------------
FROM qwen3:4b-q4_K_M

# Optimized for sub-300ms completion responses
PARAMETER temperature 0.15         # Very low for consistent completions
PARAMETER top_p 0.6                # Focused probability distribution  
PARAMETER top_k 15                 # Limited vocabulary for speed
PARAMETER num_ctx 1536             # Optimized context window
PARAMETER num_predict 80           # Short, focused completions
PARAMETER repeat_penalty 1.02      # Minimal repetition penalty
PARAMETER stop "}"                 # Stop at JSON end
PARAMETER stop "]"                 # Stop at array end  
PARAMETER stop "USER:"
PARAMETER stop "ASSISTANT:"

# Continue-compatible template
TEMPLATE """{{ if .System }}{{ .System }}
{{ end }}COMPLETE: {{ .Prompt }}
JSON:{{ .Response }}"""

SYSTEM """PowerShell completion API. Respond ONLY with valid JSON.

FORMAT:
{
  "completions": [
    {"text": "Get-ChildItem", "priority": 0.95},
    {"text": "Get-ChildItem -Path", "priority": 0.90},
    {"text": "Get-ChildItem -Recurse", "priority": 0.85}
  ],
  "context": "cmdlet_completion",
  "confidence": 0.95
}

RULES:
- Always valid JSON, no markdown, no explanations
- 3-8 completions ordered by priority (0.0-1.0)
- Higher priority = more likely user intent
- Include context hint for debugging"""

# Fast completion training examples
MESSAGE user COMPLETE: Get-Child
MESSAGE assistant {"completions": [{"text": "Get-ChildItem", "priority": 0.98}, {"text": "Get-ChildItem -Path", "priority": 0.92}, {"text": "Get-ChildItem -Recurse", "priority": 0.88}, {"text": "Get-ChildItem -Filter", "priority": 0.85}], "context": "cmdlet_completion", "confidence": 0.96}

MESSAGE user COMPLETE: Import-Mod
MESSAGE assistant {"completions": [{"text": "Import-Module", "priority": 0.97}, {"text": "Import-Module -Name", "priority": 0.93}, {"text": "Import-Module -Force", "priority": 0.89}], "context": "cmdlet_completion", "confidence": 0.95}

MESSAGE user COMPLETE: $env:USER
MESSAGE assistant {"completions": [{"text": "$env:USERNAME", "priority": 0.96}, {"text": "$env:USERPROFILE", "priority": 0.91}, {"text": "$env:USERDOMAIN", "priority": 0.86}], "context": "environment_variable", "confidence": 0.94}

MESSAGE user COMPLETE: git st
MESSAGE assistant {"completions": [{"text": "git status", "priority": 0.97}, {"text": "git status --short", "priority": 0.91}, {"text": "git stash", "priority": 0.85}, {"text": "git status --porcelain", "priority": 0.82}], "context": "git_command", "confidence": 0.94}

MESSAGE user COMPLETE: Get-Process | Where-Object {$_.
MESSAGE assistant {"completions": [{"text": "Get-Process | Where-Object {$_.Name", "priority": 0.95}, {"text": "Get-Process | Where-Object {$_.CPU", "priority": 0.90}, {"text": "Get-Process | Where-Object {$_.Id", "priority": 0.87}], "context": "pipeline_property", "confidence": 0.93}
